<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
    <HEAD>
        <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
        <TITLE>
            WebSocket パッシブスキャンルール
        </TITLE>
    </HEAD>
    <BODY>
        <H1>WebSocket パッシブスキャンルール</H1>
        <h2 id="scripts">スクリプト</h2>
        このアドオンに既定で含まれているスクリプトは、以下のWebSocketパッシブスキャンルールを実装しています。

        <h3 id="id-110002">Base64の漏洩</h3>

        このスクリプトは、着信WebSocketメッセージのペイロードを分析し、Base64 文字列を検出します。 エンコードされた情報には、エンドユーザーの利用を特に意図していない機密データが含まれている可能性があります。<br>
Base64 文字列を識別するために使用される正規表現は、パディング文字に基づいています。 その結果、エンコードされた文字列の長さが N ビットで (N)mod6=0 の場合、偽陰性 (False Negative) が発生する可能性があります。 一方、入力テキストに = で終わる文字列が含まれている場合、偽陽性 (False Positive) が発生する可能性があります。 <br>

        <p>
        例:
        <table border="1"  width = "500">
            <tr><th>オリジナル</th><th>ペイロード</th><th>結果</th></tr>
            <tr><td>Hello World</td><td>SGVsbG8gV29ybGQ=</td><td>真陽性 (True Positive)</td></tr>
            <tr><td>Hello World</td><td>THIS_ISSGVsbG8gV29ybGQ=TEXT</td><td>真陽性 (True Positive)</td></tr>
            <tr><td>Hello World!</td><td>SGVsbG8gV29ybGQK</td><td>偽陰性 (False Negative)</td></tr>
            <tr><td>122==122</td><td><i>無効</i></td><td>誤検知 (偽陽性)</td>
        </table>

        <p>
        デフォルト値:
        <table border="1"  width = "500">
            <tr><td><strong>リスク</strong></td><td>情報</td></tr>
            <tr><td><strong>信頼度</strong></td><td>中</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110002/">110002</a></td></tr>
        </table>

        <h3 id="id-110001">情報漏洩: アプリケーションエラー</h3>

        このパッシブスキャナーは、受信WebSocketメッセージのペイロードに既知のアプリケーションエラーメッセージが含まれていないかチェックします。 このような詳細へのアクセスは、悪意のある個人にWebサイトをさらに悪用する手段を与える可能性があります。 また、エンドユーザーが直接利用することを意図していないデータが漏洩する可能性もあります。<br>

        <p>
        例:
        <table border="1"  width = "500">
            <tr><th>使用例</th><th>結果</th></tr>
            <tr><td>Warning: Cannot modify header information - headers already sent</td><td>真陽性 (True Positive)</td></tr>
            <tr><td>'this' is null or not an object</td><td>真陽性 (True Positive)</td></tr>
            <tr><td>System.Data.OleDb.OleDbException: Syntax error in string in query expression 'User ID = ? And Password = ?'</td><td>真陽性 (True Positive)</td></tr>
        </table>
        <p>
        デフォルト値:
        <table border="1"  width = "500">
            <tr><td><strong>リスク</strong></td><td>中</td></tr>
            <tr><td><strong>信頼度</strong></td><td>中</td></tr>
            <tr><td><strong>CWE ID</strong></td><td>209: エラーメッセージによる情報漏洩</td></tr>
            <tr><td><strong>WASC ID</strong></td><td>13: 情報漏洩</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110001/">110001</a></td></tr>
        </table>

        <h3 id="id-110005">情報漏洩: クレジットカード番号</h3>

        このスクリプトは、受信WebSocketメッセージのペイロードに個人識別情報 (PII) が含まれていないかスキャンします。 
        具体的には、ペイロードにクレジットカード番号がないかを受動的にスキャンします。 以下のクレジットカードタイプがスキャン対象です: {American Express, Diners Club, Discover, JCB, Maestro, Master Card, Visa}.<br>

        <p>
        例:
        <table border="1"  width = "500">
            <tr><th>使用例</th><th>結果</th></tr>
            <tr><td>5264 8109 66944441</td><td>真陽性 (True Positive)</td></tr>
            <tr><td>{"z":0.4333009597918351}</td><td>誤検知 (偽陽性)</td></tr>
        </table>

        <p>
        デフォルト値:
        <table border="1"  width = "500">
            <tr><td><strong>リスク</strong></td><td>高</td></tr>
            <tr><td><strong>信頼度</strong></td><td>高</td></tr>
            <tr><td><strong>CWE ID</strong></td><td>359: 個人情報の漏洩（「プライバシー違反」）</td></tr>
            <tr><td><strong>WASC ID</strong></td><td>13: 情報漏洩</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110005/">110005</a></td></tr>
        </table>

        <h3 id="id-110003">情報漏洩: デバッグエラー</h3>

        このスクリプトは、受信WebSocketメッセージのペイロードに既知のデバッグエラーメッセージの断片が含まれていないかチェックします。 このような詳細へのアクセスは、悪意のある個人にWebサイトをさらに悪用する手段を与える可能性があります。 また、エンドユーザーが直接利用することを意図していないデータが漏洩する可能性もあります。<br>

        <p>
        例:
        <table border="1"  width = "500">
            <tr><th>使用例</th><th>結果</th></tr>
            <tr><td>Error Occurred While Processing Request</td><td>真陽性 (True Positive)</td></tr>
            <tr><td>PHP Warning: Error While Sending QUERY Packet</td><td>真陽性 (True Positive)</td></tr>
        </table>

        <p>
        デフォルト値:
        <table border="1"  width = "500">
            <tr><td><strong>リスク</strong></td><td>情報</td></tr>
            <tr><td><strong>信頼度</strong></td><td>中</td></tr>
            <tr><td><strong>CWE ID</strong></td><td>200: 情報漏洩</td></tr>
            <tr><td><strong>WASC ID</strong></td><td>13: 情報漏洩</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110003/">110003</a></td></tr>
        </table>

        <h3 id="id-110004">情報漏洩: メールアドレス</h3>

        このスクリプトは、受信WebSocketメッセージにメールアドレスが含まれていないかスキャンします。 メールアドレスは、エンドユーザーが直接利用することを意図していない可能性があります。<br>

        <p>
        デフォルト値:
        <table border="1"  width = "400">
            <tr><td><strong>リスク</strong></td><td>情報</td></tr>
            <tr><td><strong>信頼度</strong></td><td>情報</td></tr>
            <tr><td><strong>CWE ID</strong></td><td>200: 情報漏洩</td></tr>
            <tr><td><strong>WASC ID</strong></td><td>13: 情報漏洩</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110004/">110004</a></td></tr>
        </table>

        <h3 id="id-110008">情報漏洩: 疑わしいXMLコメント</h3>

        このスクリプトは、XML形式の受信WebSocketメッセージペイロードに疑わしいコメントが含まれていないかチェックします。 検索対象となるのは、攻撃者が有用な情報を引き出すために利用できるコンポーネントに関連するコメントです。 FIXME、BUGなどのコメントは、Webアプリケーションの弱点を標的としたさらなる攻撃に役立つ可能性があります。<br>

        <p>
        例:
        <table border="1"  width = "500">
            <tr><th>使用例</th><th>結果</th></tr>
            <tr><td>
                <pre>&lt;xml_test&gt;&lt;!-- This is a comments section --&gt;&lt;/xml_test&gt;</pre>
            </td><td>真陰性 (True Negative)</td>
            </tr>
            <tr><td>
                <pre>&lt;user_form&gt;&lt;!-- FIXME: Encode --&gt;&lt;/user_form&gt;</pre>
            </td><td>真陽性 (True Positive)</td>
            </tr>
        </table>

        <p>
        デフォルト値:
        <table border="1"  width = "500">
            <tr><td><strong>リスク</strong></td><td>情報</td></tr>
            <tr><td><strong>信頼度</strong></td><td>中</td></tr>
            <tr><td><strong>CWE ID</strong></td><td>200: 情報漏洩</td></tr>
            <tr><td><strong>WASC ID</strong></td><td>13: 情報漏洩</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110008/">110008</a></td></tr>
        </table>

        <h3 id="id-110006">プライベートアドレスの漏洩</h3>
        受信WebSocketメッセージのペイロードに、RFC 1918 IPv4アドレスや Amazon EC2プライベートホスト名（例: ip-10-0-56-78）が含まれていないかチェックします。 この情報により、攻撃者は内部ネットワークのIPアドレススキームに関する有用な情報を得ることができ、内部システムを標的としたさらなる攻撃に役立つ可能性があります。 <br>
このパッシブスキャナーは、vp09.02.51.10.01.09.16 のようなドット区切りの長い数値文字列の場合に誤検知 (偽陽性) が発生する可能性があります。この例では、後方の4オクテットが RFC 1918 IPv4アドレスのように見えるためです。 アナリストはレビュー後、ZAPでそのようなアラートを誤検知としてマークすることができます。<br>
        <p>
        例:
        <table border="1"  width = "200">
            <tr><th>使用例</th><th>結果</th></tr>
            <tr><td>10.255.255.255</td><td>真陽性 (True Positive)</td></tr>
            <tr><td>ip-10.0.0.0</td><td>真陽性 (True Positive)</td></tr>
        </table>
        <p>
        デフォルト値:
        <table border="1"  width = "200">
            <tr><td><strong>リスク</strong></td><td>低</td></tr>
            <tr><td><strong>信頼度</strong></td><td>中</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110006/">110006</a></td></tr>
        </table>

        <h3 id="id-110007">ユーザー名の露見</h3>

        受信WebSocketメッセージのペイロードにユーザー名が含まれていないかチェックします。 このスクリプトは、以下のメソッドでハッシュ化されたユーザー名を検出できます: {MD2, MD5, SHA256, SHA384, SHA512}。 ユーザー名は、事前にいずれかのコンテキストで定義されている必要があります。 コンテキストにユーザーを追加するには、以下の手順に従います：
        <ol>
            <li>ハンドシェイクリクエストを Context に含める</li>
            <li>Session Context でターゲットユーザーを設定する</li>
        </ol>

        <p>
        デフォルト値:
        <table border="1"  width = "400">
            <tr><td><strong>リスク</strong></td><td>情報</td></tr>
            <tr><td><strong>信頼度</strong></td><td>高</td></tr>
            <tr><td><strong>CWE ID</strong></td><td>284: 不適切なアクセス制御</td></tr>
            <tr><td><strong>WASC ID</strong></td><td>2: 不十分な認可</td></tr>
            <tr><td><strong>アラートID:</strong></td><td><a href="https://www.zaproxy.org/docs/alerts/110007/">110007</a></td></tr>
        </table>
        
    </BODY>
</HTML>
